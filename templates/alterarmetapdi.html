{% extends 'base.html' %}

{% block titulo %}
    Alterar Meta - PRPPG
{% endblock %}

{% block conteudo %}
<div class="card" style="max-width: 600px; margin: 0 auto;">
    <div class="card-header" style="background-color: #054b91;">
        <h4 style="text-align: center; color: #ffffff;">Alterar Meta</h4> <!-- Texto em branco com fundo azul -->
    </div>
    <div class="card-body">
        <form id="MetaForm" method="POST">
            <label for="pdi_id">PDI:</label>
            <select id="pdi_id" name="pdi_id" required style="width: 100%; margin-bottom: 10px;">
                {% for pdi in lista_pdis %}
                    <option value="{{ pdi.id }}" {% if pdi.id == meta.objetivo.pdi_id %}selected{% endif %}>{{ pdi.nome }}</option>
                {% endfor %}
            </select>
            <br>

            <label for="objetivo_id">Objetivo:</label>
            <select id="objetivo_id" name="objetivo_id" required style="width: 100%; margin-bottom: 10px;">
                {% for objetivo in objetivos %}
                    <option value="{{ objetivo.id }}" {% if objetivo.id == meta.objetivo_id %}selected{% endif %}>{{ objetivo.nome }}</option>
                {% endfor %}
            </select>
            <br>

            <label for="nome">Nome da Meta:</label>
            <input type="text" id="nome" name="nome" value="{{ meta.nome }}" required style="width: 100%; margin-bottom: 10px;">
            <br>

            <label for="porcentagem_execucao">Porcentagem de Execução:</label>
            <input type="number" id="porcentagem_execucao" name="porcentagem_execucao" value="{{ meta.porcentagem_execucao }}" required style="width: 100%; margin-bottom: 10px;">
            <br>

            <div style="text-align: center;">
                <button type="submit" style="background-color: darkblue; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer;">Salvar Alterações</button>
                <button type="button" onclick="cancelar()" style="background-color: #f44336; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; margin-left: 10px;">Cancelar</button>
            </div>
        </form>
    </div>
</div>

<script>
    function cancelar() {
        window.location.href = "{{ url_for('cadastro_meta') }}";
    }

    // Atualiza a lista de objetivos ao selecionar um PDI
    document.getElementById('pdi_id').addEventListener('change', function() {
        var pdiId = this.value;
        fetch('/objetivos_relacionados_pdi/' + pdiId)
            .then(response => response.json())
            .then(data => {
                var selectObjetivos = document.getElementById('objetivo_id');
                selectObjetivos.innerHTML = '';
                data.forEach(objetivo => {
                    var option = document.createElement('option');
                    option.value = objetivo.id;
                    option.text = objetivo.nome;
                    selectObjetivos.appendChild(option);
                });
            })
            .catch(error => console.error('Erro ao buscar objetivos:', error));
    });
</script>
{% endblock %}
