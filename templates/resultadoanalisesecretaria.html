{% extends 'basepro.html' %}

{% block titulo %}
<h1 style="text-align: center; margin-bottom: 20px;">Resultados da Análise da Autoavaliação de Secretarias</h1>
{% endblock %}

{% block conteudo %}
<div class="card">
    <div class="card-header" style="background-color: #054b91;">
        <h4 style="text-align: center; color: #ffffff;">Análise dos Resultados</h4>
    </div>
    <div class="card-body">

        <!-- Média de Sentimentos -->
        <h3 style="text-align: center;">Análise de Sentimentos</h3>
        <p style="text-align: center;">Média de Sentimentos do Programa: {{ media_programa | default('N/A') }}</p>

        <!-- Gráfico de Sentimentos -->
        <div style="text-align: center;">
            {% if grafico_sentimentos_ingresso %}
            <img src="data:image/png;base64,{{ grafico_sentimentos_ingresso }}" alt="Gráfico de Sentimentos" style="max-width: 80%; height: auto; margin: 20px 0;">
            {% else %}
            <p style="color: red;">Gráfico de sentimentos não disponível</p>
            {% endif %}
        </div>

        <!-- Resultados do Modelo Otimizado -->
        <h3 style="text-align: center;">Resultados do Modelo Otimizado</h3>
        <p style="text-align: center;">MSE após otimização: {{ mse_otimizado | default('N/A') }}</p>

        <!-- Tabela de Recomendações por Programa -->
        <h3 style="text-align: center;">Recomendações por Programa</h3>
        <table class="table table-striped table-bordered" style="width: 100%; margin: auto;">
            <thead>
                <tr>
                    <th style="text-align: center;">Programa</th>
                    <th style="text-align: center;">MSE RandomForest</th>
                    <th style="text-align: center;">MSE GradientBoosting</th>
                    <th style="text-align: center;">Média de Sentimentos</th>
                    <th style="text-align: center;">Recomendações</th>
                </tr>
            </thead>
            <tbody>
                {% if recomendacoes_por_programa %}
                {% for programa, dados in recomendacoes_por_programa.items() %}
                <tr>
                    <td>{{ programa }}</td>
                    <td style="text-align: center;">{{ dados.get('mse_rf', 'N/A') | round(6) if dados.get('mse_rf') is not none else 'N/A' }}</td>
                    <td style="text-align: center;">{{ dados.get('mse_gb', 'N/A') | round(6) if dados.get('mse_gb') is not none else 'N/A' }}</td>
                    <td style="text-align: center;">{{ dados.get('media_sentimentos_programa', 'N/A') | round(2) if dados.get('media_sentimentos_programa') is not none else 'N/A' }}</td>
                    <td>
                        <ul>
                            {% if dados.get('recomendacoes') %}
                                {% for recomendacao in dados.get('recomendacoes') %}
                                <li>{{ recomendacao }}</li>
                                {% endfor %}
                            {% else %}
                                <li>Sem recomendações</li>
                            {% endif %}
                        </ul>
                    </td>
                </tr>
                {% endfor %}
                {% else %}
                <tr>
                    <td colspan="5" style="text-align: center; color: red;">Nenhuma recomendação disponível</td>
                </tr>
                {% endif %}
            </tbody>
        </table>

        <!-- Botões de navegação -->
        <div style="text-align: center; margin-top: 40px;">
            <button onclick="window.history.back()" class="btn btn-success" style="padding: 10px 20px; border: none; border-radius: 4px; font-size: 16px;">Voltar</button>
            <button type="button" onclick="fechar()" class="btn btn-danger" style="padding: 10px 20px; border: none; border-radius: 4px; font-size: 16px;">Fechar</button>
        </div>
        <script>
            function fechar() {
                window.close(); // Tenta fechar a janela
                window.location.href = "{{ url_for('login.get_proreitor') }}"; // Redireciona se a janela não puder ser fechada
            }
        </script>
    </div>
</div>
{% endblock %}
