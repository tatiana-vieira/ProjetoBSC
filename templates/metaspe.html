{% extends 'basecord.html' %}

{% block titulo %}
    Cadastro do Planejamento Estratégico - PRPPG
{% endblock %}

{% block conteudo %}
{% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
        {% for category, message in messages %}
            <div class="alert alert-{{ category }}" role="alert">
                {{ message }}
            </div>
        {% endfor %}
    {% endif %}
{% endwith %}

<div style="margin: auto; width: 50%; text-align: center;">
  <div class="form-block">
    <h3>Cadastro de Metas</h3><br>
    <form method="POST" action="{{ url_for('associar_metaspe') }}">
      <label for="objetivo_pe_id">Selecione o Objetivo:</label><br>
      <select name="objetivo_pe_id" required style="width: 90%; margin-bottom: 10px;">
          {% for objetivo in objetivos_pe %}
              <option value="{{ objetivo.id }}">{{ objetivo.nome }}</option>
          {% endfor %}
      </select>
      <br>

      <label for="nome">Nome da Meta:</label><br>
      <input type="text" id="nome" name="nome" required style="width: 90%; margin-bottom: 10px;"><br>

      <label for="descricao">Descrição da Meta:</label><br>
      <textarea id="descricao" name="descricao" required style="width: 90%; margin-bottom: 10px;"></textarea><br>

      <label for="responsavel">Responsável:</label><br>
      <input type="text" id="responsavel" name="responsavel" required style="width: 90%; margin-bottom: 10px;"><br>

      <label for="recursos">Recursos Necessários:</label><br>
      <textarea id="recursos" name="recursos" required style="width: 90%; margin-bottom: 10px;"></textarea><br>

      <label for="data_inicio">Data de Início:</label><br>
      <input type="date" id="data_inicio" name="data_inicio" required style="width: 90%; margin-bottom: 10px;"><br>

      <label for="data_termino">Data de Término:</label><br>
      <input type="date" id="data_termino" name="data_termino" required style="width: 90%; margin-bottom: 10px;"><br>

      <label for="status_inicial">Status Inicial (em %):</label><br>
      <input type="number" id="status_inicial" name="status_inicial" required min="0" max="100" step="1" style="width: 90%; margin-bottom: 10px;"><br>

      <label for="valor_alvo">Valor Alvo:</label><br>
      <input type="number" id="valor_alvo" name="valor_alvo" required step="0.01" style="width: 90%; margin-bottom: 10px;"><br>

      <div id="campos-dinamicos">
        <div class="row" style="margin-bottom: 10px;">
            <div class="col-md-3">
                <label for="ano">Ano:</label>
                <input type="number" name="ano[]" required style="width: 100%;">
            </div>
            <div class="col-md-3">
                <label for="semestre">Semestre:</label>
                <select name="semestre[]" required style="width: 100%;">
                    <option value="">-- Selecione --</option>
                    <option value="1">1º Semestre (Jan-Jun)</option>
                    <option value="2">2º Semestre (Jul-Dez)</option>
                </select>
            </div>
            <div class="col-md-3">
                <label for="valor">Valor:</label>
                <input type="number" step="0.01" name="valor[]" required style="width: 100%;">
            </div>
            <div class="col-md-3" style="display: flex; align-items: flex-end; justify-content: space-between;">
                <button type="button" id="add-button" style="background-color: #28a745; color: white; padding: 10px; border: none; border-radius: 4px; cursor: pointer;">Adicionar</button>
                <span style="margin-left: 10px; align-self: center; white-space: nowrap;">Obs.: Adicionar ano, semestre e valor.</span>
            </div>
        </div>
      </div>

      <div style="margin-top: 20px;">
          <button type="submit" style="background-color: darkblue; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer;">Cadastrar</button>
          <button type="button" onclick="fechar()" style="background-color: #f44336; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; margin-left: 10px;">Fechar</button>
      </div>
   </form>
 </div>
</div>

<style>
.alert-success {
    color: #155724;
    background-color: #d4edda;
    border-color: #c3e6cb;
}

.alert-error {
    color: #721c24;
    background-color: #f8d7da;
    border-color: #f5c6cb;
}

.form-block .row {
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.form-block .row .col-md-3 {
    flex: 1;
    margin-right: 10px;
}
</style>

<script>
  function fechar() {
      window.location.href = "{{ url_for('login.get_coordenador') }}";
  }

  document.addEventListener('DOMContentLoaded', function() {
    const addButton = document.getElementById('add-button');
    const camposDinamicos = document.getElementById('campos-dinamicos');

    addButton.addEventListener('click', function() {
      const novoCampo = document.createElement('div');
      novoCampo.classList.add('row');
      novoCampo.style.marginBottom = '10px';

      novoCampo.innerHTML = `
        <div class="col-md-3">
          <label for="ano">Ano</label>
          <input type="number" name="ano[]" required style="width: 100%;">
        </div>
        <div class="col-md-3">
          <label for="semestre">Semestre</label>
          <select name="semestre[]" required style="width: 100%;">
              <option value="">-- Selecione --</option>
              <option value="1">1º Semestre (Jan-Jun)</option>
              <option value="2">2º Semestre (Jul-Dez)</option>
          </select>
        </div>
        <div class="col-md-3">
          <label for="valor">Valor</label>
          <input type="number" step="0.01" name="valor[]" required style="width: 100%;">
        </div>
      `;

      camposDinamicos.appendChild(novoCampo);
    });
  });
</script>
{% endblock %}