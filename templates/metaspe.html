{% extends 'basecord.html' %}

{% block titulo %}
  Objetivos - Planejamento Estratégico
{% endblock %}

{% block conteudo %}
<div style="margin: auto; width: 50%; text-align: center;">
  <div class="form-block"><br>
    <h2>Planejamento Estratégico - Meta</h2><br>
    <form id="form-metaspe" method="POST" action="{{ url_for('planejamento.associar_metaspe') }}">
      <label for="planejamento_id">Selecione o Planejamento Estratégico:</label></br>
      <select id="planejamento_id" name="planejamento_id" required style="width: 100%; margin-bottom: 10px;">
          {% for pe in planejamentos_estrategicos %}
              <option value="{{ pe.id }}">{{ pe.nome }}</option>
          {% endfor %}
      </select><br>
  
      <label for="objetivo_pe_id">Selecione o Objetivo:</label></br>
      <select id="objetivo_pe_id" name="objetivo_pe_id" required style="width: 100%; margin-bottom: 10px;">
          <!-- Objetivos serão preenchidos dinamicamente via JavaScript -->
      </select><br>
      
      <label for="nome">Nome da Meta:</label><br>
      <input type="text" id="nome" name="nome" required style="width: 100%; margin-bottom: 10px;"><br>
      
      <label for="porcentagem_execucao">Porcentagem de Execução:</label><br>
      <input type="number" id="porcentagem_execucao" name="porcentagem_execucao" required style="width: 100%; margin-bottom: 10px;"><br>
      
      <input type="hidden" id="planejamento_id_hidden" name="planejamento_id_hidden">

      <button type="submit" style="background-color: darkblue; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer;">Cadastrar</button>
      <button type="button" onclick="cancelar()" style="background-color: #f44336; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; margin-left: 10px;">Cancelar</button><br>            
    </form>
</div>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
$(document).ready(function() {
  $('#planejamento_id').change(function() {
    var planejamento_id = $(this).val();
    $('#planejamento_id_hidden').val(planejamento_id);

    $.ajax({
      url: '/get_objetivosplano/' + planejamento_id,
      type: 'GET',
      success: function(data) {
        $('#objetivo_pe_id').html('');
        $.each(data, function(index, objetivo) {
          $('#objetivo_pe_id').append('<option value="' + objetivo.id + '">' + objetivo.nome + '</option>');
        });
      },
      error: function(jqXHR, textStatus, errorThrown) {
        console.error("Erro ao recuperar objetivos:", textStatus, errorThrown);
        // Optionally display an error message to the user
      }
    });
  });
});


  function cancelar() {
    // Redireciona para a página do coordenador após o login
    window.location.href = "{{ url_for('login.get_coordenador') }}";
  }
</script> 
  <!-- Exibir objetivos relacionados ao PDI selecionado -->

{% endblock %}